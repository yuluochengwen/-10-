{% extends "base/base.html" %}

{% block title %}支付确认 - SmartStore{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
{% endblock %}

{% block content %}
    <!-- Page Header -->
    <section class="page-header bg-gradient-to-r from-green-600 to-blue-600 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">支付确认</h1>
            <p class="text-xl text-green-100">请选择您的支付方式</p>
        </div>
    </section>
    
    <!-- Payment Content -->
    <section class="payment-section py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Order Summary -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                        <h3 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                            <i class="fas fa-receipt mr-2"></i>订单详情
                        </h3>
                        
                        <!-- Order Items -->
                        <div id="order-items" class="space-y-4 mb-6">
                            <!-- Items will be loaded here -->
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="border-t pt-4 space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">商品小计</span>
                                <span id="subtotal">¥0.00</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">配送费</span>
                                <span id="shipping-fee">¥0.00</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">优惠折扣</span>
                                <span id="discount" class="text-red-600">-¥0.00</span>
                            </div>
                            <div class="flex justify-between text-lg font-semibold text-gray-900 pt-2 border-t">
                                <span>总计</span>
                                <span id="total-amount" class="text-red-600">¥0.00</span>
                            </div>
                        </div>
                        
                        <!-- Payment Security Notice -->
                        <div class="mt-6 p-4 bg-green-50 rounded-lg">
                            <div class="flex items-center space-x-2 text-sm text-green-800">
                                <i class="fas fa-shield-alt"></i>
                                <span>支付安全保障</span>
                            </div>
                            <p class="text-xs text-green-700 mt-1">您的支付信息经过SSL加密保护</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl shadow-lg p-8">
                        <h3 class="text-xl font-semibold text-gray-900 mb-8">选择支付方式</h3>
                        
                        <!-- Payment Options -->
                        <div class="space-y-6">
                            <!-- Face Payment -->
                            <div class="payment-method border-2 border-gray-200 rounded-2xl p-6 hover:border-green-500 transition-colors cursor-pointer" data-method="face">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-face-smile text-green-600 text-2xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-900">人脸支付</h4>
                                            <p class="text-sm text-gray-600">快速安全的人脸识别支付</p>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">推荐</span>
                                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">免密支付</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- QR Code Payment -->
                            <div class="payment-method border-2 border-gray-200 rounded-2xl p-6 hover:border-blue-500 transition-colors cursor-pointer" data-method="qr">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-qrcode text-blue-600 text-2xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-900">二维码支付</h4>
                                            <p class="text-sm text-gray-600">支持微信、支付宝扫码支付</p>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">微信</span>
                                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">支付宝</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Card Payment -->
                            <div class="payment-method border-2 border-gray-200 rounded-2xl p-6 hover:border-purple-500 transition-colors cursor-pointer" data-method="card">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center">
                                            <i class="fas fa-credit-card text-purple-600 text-2xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-900">银行卡支付</h4>
                                            <p class="text-sm text-gray-600">支持各大银行借记卡、信用卡</p>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">储蓄卡</span>
                                                <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">信用卡</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 border-2 border-gray-300 rounded-full mr-3 payment-radio"></div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Button -->
                        <div class="mt-8">
                            <button id="proceed-payment" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-4 rounded-lg text-lg font-semibold hover:from-green-700 hover:to-green-800 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-credit-card mr-2"></i>确认支付 ¥<span id="payment-amount">0.00</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Face Payment Modal -->
    <div id="face-payment-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">人脸支付</h3>
                <p class="text-gray-600">请将脸部对准摄像头完成支付</p>
            </div>
            
            <div class="face-payment-container mb-6">
                <div class="relative w-64 h-64 mx-auto bg-gray-100 rounded-2xl overflow-hidden">
                    <!-- Camera Feed -->
                    <video id="payment-camera" class="w-full h-full object-cover hidden" autoplay muted></video>
                    
                    <!-- Payment Scan Overlay -->
                    <div id="payment-scan-overlay" class="absolute inset-0 flex items-center justify-center">
                        <div class="payment-scan-frame w-48 h-48 border-4 border-green-500 rounded-full relative">
                            <div class="payment-scan-line absolute top-0 left-0 right-0 h-1 bg-green-400 rounded-full animate-pulse"></div>
                            <div class="payment-scan-dots">
                                <div class="payment-scan-dot absolute w-3 h-3 bg-green-500 rounded-full" style="top: 20%; left: 20%;"></div>
                                <div class="payment-scan-dot absolute w-3 h-3 bg-green-500 rounded-full" style="top: 20%; right: 20%;"></div>
                                <div class="payment-scan-dot absolute w-3 h-3 bg-green-500 rounded-full" style="bottom: 20%; left: 20%;"></div>
                                <div class="payment-scan-dot absolute w-3 h-3 bg-green-500 rounded-full" style="bottom: 20%; right: 20%;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment Status -->
                    <div id="payment-status" class="absolute bottom-4 left-0 right-0 text-center">
                        <div class="bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg mx-4">
                            <i class="fas fa-camera mr-2"></i>
                            <span id="payment-status-text">正在识别...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Progress -->
            <div id="payment-progress" class="mb-6 hidden">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-600">支付进度</span>
                    <span id="progress-percent" class="text-sm font-semibold text-green-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button id="cancel-face-payment" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors">
                    取消支付
                </button>
                <button id="retry-face-payment" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors hidden">
                    重试
                </button>
            </div>
        </div>
    </div>
    
    <!-- QR Payment Modal -->
    <div id="qr-payment-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">二维码支付</h3>
            
            <div class="mb-6">
                <div class="w-64 h-64 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <div id="payment-qr" class="text-center">
                        <i class="fas fa-qrcode text-8xl text-gray-600 mb-4"></i>
                        <p class="text-gray-600">正在生成支付二维码...</p>
                    </div>
                </div>
                
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="wechat-pay" class="flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fab fa-weixin"></i>
                        <span>微信支付</span>
                    </button>
                    <button id="alipay-pay" class="flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fab fa-alipay"></i>
                        <span>支付宝</span>
                    </button>
                </div>
                
                <p class="text-sm text-gray-600">请使用相应的APP扫描二维码完成支付</p>
            </div>
            
            <!-- Payment Status -->
            <div id="qr-payment-status" class="mb-6 hidden">
                <div class="flex items-center justify-center space-x-2 text-green-600">
                    <i class="fas fa-check-circle"></i>
                    <span>支付成功！</span>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button id="close-qr-payment" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors">
                    取消支付
                </button>
                <button id="complete-qr-payment" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors hidden">
                    完成支付
                </button>
            </div>
        </div>
    </div>
    
    <!-- Payment Success Modal -->
    <div id="payment-success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-check text-green-600 text-3xl"></i>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-900 mb-4">支付成功！</h3>
            <p class="text-gray-600 mb-6">您的订单已确认，我们将尽快为您安排配送</p>
            
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">订单号</span>
                    <span id="order-number" class="font-mono text-sm">#2024123456789</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">支付金额</span>
                    <span id="paid-amount" class="font-semibold text-green-600">¥0.00</span>
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button id="view-order" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    查看订单
                </button>
                <button id="continue-shopping" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors">
                    继续购物
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/user.js') }}"></script>
{% endblock %}